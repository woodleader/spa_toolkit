<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Hash Checker</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f4f9;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            color: #333;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 70%;
            text-align: center;
        }

        #drop-zone {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 40px 20px;
            margin: 20px 0;
            transition: all 0.2s ease;
            cursor: pointer;
            background-color: #fafafa;
        }

        #drop-zone.drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
            color: #3b82f6;
        }

        #file-input {
            display: none;
        }

        .result-box {
            margin-top: 20px;
            text-align: left;
            display: none;
            /* Hidden until file is dropped */
        }

        .label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .value {
            font-family: "Courier New", Courier, monospace;
            background: #eee;
            padding: 8px;
            border-radius: 4px;
            word-break: break-all;
            font-size: 0.9rem;
        }

        .loading {
            color: #3b82f6;
            font-weight: bold;
            display: none;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
            width: 100%;
        }

        .hash-input {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .comparison-result {
            margin-top: 15px;
            font-weight: bold;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
    </style>
</head>

<body>

    <div class="container">
        <h2>Hash Checker</h2>
        <p>Drag & drop a file below</p>

        <div class="input-group">
            <label for="expected-hash" class="label">Compare with (optional):</label>
            <input type="text" id="expected-hash" class="hash-input" placeholder="Enter expected MD5 or SHA-256 hash">
        </div>


        <div id="drop-zone">
            Drop file here or click to upload
        </div>
        <input type="file" id="file-input">

        <div id="loading" class="loading">Calculating Hash...</div>

        <div id="result" class="result-box">
            <div class="label">File Name:</div>
            <div id="file-name" class="value"></div>
            <br>
            <div class="label">MD5 Hash:</div>
            <div id="hash-output" class="value"></div>
            <br>
            <div class="label">SHA-256 Hash:</div>
            <div id="sha256-output" class="value"></div>

            <div id="comparison-result" class="comparison-result"></div>
        </div>
    </div>

    <script>
        // --- 1. MD5 Algorithm Implementation ---
        // Adapted for ArrayBuffer support to handle binary files locally
        var MD5 = function (inputString) {
            var hc = "0123456789abcdef";
            function rh(n) { var j, s = ""; for (j = 0; j <= 3; j++) s += hc.charAt((n >> (j * 8 + 4)) & 0x0F) + hc.charAt((n >> (j * 8)) & 0x0F); return s; }
            function ad(x, y) { var l = (x & 0xFFFF) + (y & 0xFFFF); var m = (x >> 16) + (y >> 16) + (l >> 16); return (m << 16) | (l & 0xFFFF); }
            function rl(n, c) { return (n << c) | (n >>> (32 - c)); }
            function cm(q, a, b, x, s, t) { return ad(rl(ad(ad(a, q), ad(x, t)), s), b); }
            function ff(a, b, c, d, x, s, t) { return cm((b & c) | ((~b) & d), a, b, x, s, t); }
            function gg(a, b, c, d, x, s, t) { return cm((b & d) | (c & (~d)), a, b, x, s, t); }
            function hh(a, b, c, d, x, s, t) { return cm(b ^ c ^ d, a, b, x, s, t); }
            function ii(a, b, c, d, x, s, t) { return cm(c ^ (b | (~d)), a, b, x, s, t); }
            function sb(x) {
                var i; var nblk = ((x.length + 8) >> 6) + 1; // number of 16-word blocks
                var blks = Array(nblk * 16);
                for (i = 0; i < nblk * 16; i++) blks[i] = 0;
                for (i = 0; i < x.length; i++) blks[i >> 2] |= x.charCodeAt(i) << ((i % 4) * 8);
                blks[i >> 2] |= 0x80 << ((i % 4) * 8);
                blks[nblk * 16 - 2] = x.length * 8;
                return blks;
            }
            var i, x = sb(inputString), a = 1732584193, b = -271733879, c = -1732584194, d = 271733878, olda, oldb, oldc, oldd;
            for (i = 0; i < x.length; i += 16) {
                olda = a; oldb = b; oldc = c; oldd = d;
                a = ff(a, b, c, d, x[i + 0], 7, -680876936);
                d = ff(d, a, b, c, x[i + 1], 12, -389564586);
                c = ff(c, d, a, b, x[i + 2], 17, 606105819);
                b = ff(b, c, d, a, x[i + 3], 22, -1044525330);
                a = ff(a, b, c, d, x[i + 4], 7, -176418897);
                d = ff(d, a, b, c, x[i + 5], 12, 1200080426);
                c = ff(c, d, a, b, x[i + 6], 17, -1473231341);
                b = ff(b, c, d, a, x[i + 7], 22, -45705983);
                a = ff(a, b, c, d, x[i + 8], 7, 1770035416);
                d = ff(d, a, b, c, x[i + 9], 12, -1958414417);
                c = ff(c, d, a, b, x[i + 10], 17, -42063);
                b = ff(b, c, d, a, x[i + 11], 22, -1990404162);
                a = ff(a, b, c, d, x[i + 12], 7, 1804603682);
                d = ff(d, a, b, c, x[i + 13], 12, -40341101);
                c = ff(c, d, a, b, x[i + 14], 17, -1502002290);
                b = ff(b, c, d, a, x[i + 15], 22, 1236535329);
                a = gg(a, b, c, d, x[i + 1], 5, -165796510);
                d = gg(d, a, b, c, x[i + 6], 9, -1069501632);
                c = gg(c, d, a, b, x[i + 11], 14, 643717713);
                b = gg(b, c, d, a, x[i + 0], 20, -373897302);
                a = gg(a, b, c, d, x[i + 5], 5, -701558691);
                d = gg(d, a, b, c, x[i + 10], 9, 38016083);
                c = gg(c, d, a, b, x[i + 15], 14, -660478335);
                b = gg(b, c, d, a, x[i + 4], 20, -405537848);
                a = gg(a, b, c, d, x[i + 9], 5, 568446438);
                d = gg(d, a, b, c, x[i + 14], 9, -1019803690);
                c = gg(c, d, a, b, x[i + 3], 14, -187363961);
                b = gg(b, c, d, a, x[i + 8], 20, 1163531501);
                a = gg(a, b, c, d, x[i + 13], 5, -1444681467);
                d = gg(d, a, b, c, x[i + 2], 9, -51403784);
                c = gg(c, d, a, b, x[i + 7], 14, 1735328473);
                b = gg(b, c, d, a, x[i + 12], 20, -1926607734);
                a = hh(a, b, c, d, x[i + 5], 4, -378558);
                d = hh(d, a, b, c, x[i + 8], 11, -2022574463);
                c = hh(c, d, a, b, x[i + 11], 16, 1839030562);
                b = hh(b, c, d, a, x[i + 14], 23, -35309556);
                a = hh(a, b, c, d, x[i + 1], 4, -1530992060);
                d = hh(d, a, b, c, x[i + 4], 11, 1272893353);
                c = hh(c, d, a, b, x[i + 7], 16, -155497632);
                b = hh(b, c, d, a, x[i + 10], 23, -1094730640);
                a = hh(a, b, c, d, x[i + 13], 4, 681279174);
                d = hh(d, a, b, c, x[i + 0], 11, -358537222);
                c = hh(c, d, a, b, x[i + 3], 16, -722521979);
                b = hh(b, c, d, a, x[i + 6], 23, 76029189);
                a = hh(a, b, c, d, x[i + 9], 4, -640364487);
                d = hh(d, a, b, c, x[i + 12], 11, -421815835);
                c = hh(c, d, a, b, x[i + 15], 16, 530742520);
                b = hh(b, c, d, a, x[i + 2], 23, -995338651);
                a = ii(a, b, c, d, x[i + 0], 6, -198630844);
                d = ii(d, a, b, c, x[i + 7], 10, 1126891415);
                c = ii(c, d, a, b, x[i + 14], 15, -1416354905);
                b = ii(b, c, d, a, x[i + 5], 21, -57434055);
                a = ii(a, b, c, d, x[i + 12], 6, 1700485571);
                d = ii(d, a, b, c, x[i + 3], 10, -1894986606);
                c = ii(c, d, a, b, x[i + 10], 15, -1051523);
                b = ii(b, c, d, a, x[i + 1], 21, -2054922799);
                a = ii(a, b, c, d, x[i + 8], 6, 1873313359);
                d = ii(d, a, b, c, x[i + 15], 10, -30611744);
                c = ii(c, d, a, b, x[i + 6], 15, -1560198380);
                b = ii(b, c, d, a, x[i + 13], 21, 1309151649);
                a = ii(a, b, c, d, x[i + 4], 6, -145523070);
                d = ii(d, a, b, c, x[i + 11], 10, -1120210379);
                c = ii(c, d, a, b, x[i + 2], 15, 718787259);
                b = ii(b, c, d, a, x[i + 9], 21, -343485551);
                a = ad(a, olda);
                b = ad(b, oldb);
                c = ad(c, oldc);
                d = ad(d, oldd);
            }
            return rh(a) + rh(b) + rh(c) + rh(d);
        };

        // Helper to process ArrayBuffer
        function calculateMD5(arrayBuffer) {
            var bytes = new Uint8Array(arrayBuffer);
            var length = bytes.byteLength;
            var binary = "";
            for (var i = 0; i < length; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return MD5(binary);
        }

        async function calculateSHA256(arrayBuffer) {
            const hashBuffer = await crypto.subtle.digest('SHA-256', arrayBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        // --- 2. UI Interaction Logic ---
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const resultBox = document.getElementById('result');
        const fileNameDisplay = document.getElementById('file-name');
        const hashOutput = document.getElementById('hash-output');
        const sha256Output = document.getElementById('sha256-output');
        const loading = document.getElementById('loading');
        const expectedHashInput = document.getElementById('expected-hash');
        const comparisonResult = document.getElementById('comparison-result');

        // Click to upload support
        dropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));

        // Drag and Drop support
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            if (e.dataTransfer.files.length) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        function handleFile(file) {
            if (!file) return;

            // Reset UI
            resultBox.style.display = 'none';
            loading.style.display = 'block';
            fileNameDisplay.textContent = file.name;

            // Use FileReader to read file locally
            const reader = new FileReader();

            reader.onload = async function (event) {
                try {
                    const arrayBuffer = event.target.result;
                    // Calculate Hashes
                    const md5Hash = calculateMD5(arrayBuffer);
                    const sha256Hash = await calculateSHA256(arrayBuffer);

                    // Update UI
                    hashOutput.textContent = md5Hash;
                    sha256Output.textContent = sha256Hash;
                    loading.style.display = 'none';
                    resultBox.style.display = 'block';

                    // Compare if expected hash is provided
                    const expected = expectedHashInput.value.trim().toLowerCase();
                    if (expected) {
                        comparisonResult.style.display = 'block';
                        if (expected === md5Hash || expected === sha256Hash) {
                            comparisonResult.textContent = "✅ Success: Hashes Match!";
                            comparisonResult.style.backgroundColor = "#d1fae5";
                            comparisonResult.style.color = "#065f46";
                            comparisonResult.style.border = "1px solid #34d399";
                        } else {
                            comparisonResult.textContent = "❌ Error: Hash Mismatch!";
                            comparisonResult.style.backgroundColor = "#fee2e2";
                            comparisonResult.style.color = "#991b1b";
                            comparisonResult.style.border = "1px solid #f87171";
                        }
                    } else {
                        comparisonResult.style.display = 'none';
                    }
                } catch (err) {
                    alert("Error reading file: " + err);
                    loading.style.display = 'none';
                }
            };

            reader.readAsArrayBuffer(file);
        }
    </script>

</body>

</html>